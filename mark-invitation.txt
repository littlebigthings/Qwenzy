        
        // If this is an invitation and the user now has an organization, mark the invitation as accepted
        if (isInvitation && invitationOrgId && memberships.length > 0 && user.email) {
          try {
            console.log("Marking invitation as accepted");
            await markInvitationAsAccepted(user.email, invitationOrgId);
          } catch (error) {
            console.error("Error marking invitation as accepted:", error);
          }
        }
